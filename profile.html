<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mon Profil - Post Match Generator</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">

  <!-- CSS -->
  <link rel="stylesheet" href="css/common.css">
  <link rel="stylesheet" href="css/profile.css">

  <!-- Supabase SDK -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body>

  <!-- Background -->
  <div class="bg-gradient"></div>
  <div class="bg-grid"></div>
  <div class="orb orb-1"></div>
  <div class="orb orb-2"></div>

  <!-- Content -->
  <div class="profile-container content">

    <a href="selection.html" class="btn-back">← Retour</a>

    <!-- Header -->
    <div class="profile-header">
      <div class="avatar" id="avatar">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
          <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
          <circle cx="12" cy="7" r="4"/>
        </svg>
      </div>
      <h1 class="profile-name" id="profileName">Chargement...</h1>
      <p class="profile-email" id="profileEmail">...</p>
    </div>

    <!-- Profile Card -->
    <div class="profile-card">

      <!-- Informations du club -->
      <div class="profile-section">
        <h2 class="section-title">Mon club</h2>

        <div class="info-row">
          <div class="info-label">Nom du club</div>
          <div class="info-value" id="infoNom">-</div>
        </div>

        <div class="info-row">
          <div class="info-label">Abréviation</div>
          <div class="info-value" id="infoAbbr">-</div>
        </div>

        <div class="info-row">
          <div class="info-label">Logo</div>
          <div class="info-value">
            <div class="club-logo-preview" id="infoLogo">
              <span>Aucun logo</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Informations du compte -->
      <div class="profile-section">
        <h2 class="section-title">Informations du compte</h2>

        <div class="info-row">
          <div class="info-label">Adresse e-mail</div>
          <div class="info-value" id="infoEmail">-</div>
        </div>

        <div class="info-row">
          <div class="info-label">Date d'inscription</div>
          <div class="info-value" id="infoDate">-</div>
        </div>

        <div class="info-row">
          <div class="info-label">Statut du compte</div>
          <div class="info-value">
            <span class="status-badge" id="infoStatut">Vérifié</span>
          </div>
        </div>
      </div>

      <!-- Actions -->
      <div class="profile-section">
        <h2 class="section-title">Actions</h2>
        <div class="actions-list">
          <button class="btn-action btn-logout" id="btnLogout">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
              <polyline points="16 17 21 12 16 7"/>
              <line x1="21" y1="12" x2="9" y2="12"/>
            </svg>
            Se déconnecter
          </button>
        </div>
      </div>

    </div>

  </div>

  <!-- Version -->
  <p class="version">v1.0</p>

  <!-- JavaScript -->
  <script src="js/supabase-config.js"></script>
  <script src="js/auth.js"></script>
  <script src="js/clubs-supabase.js"></script>
  <script>
    // Éléments DOM - Profil
    const profileName = document.getElementById('profileName');
    const profileEmail = document.getElementById('profileEmail');
    const infoNom = document.getElementById('infoNom');
    const infoAbbr = document.getElementById('infoAbbr');
    const infoLogo = document.getElementById('infoLogo');
    const infoEmail = document.getElementById('infoEmail');
    const infoDate = document.getElementById('infoDate');
    const infoStatut = document.getElementById('infoStatut');
    const btnLogout = document.getElementById('btnLogout');
    const avatar = document.getElementById('avatar');

    // Charger les informations du profil
    (async () => {
      const session = await getSession();

      if (!session) {
        window.location.href = 'index.html';
        return;
      }

      const user = session.user;

      // Nom du club (stocké dans user_metadata.nom_utilisateur)
      const nomClub = user.user_metadata?.nom_utilisateur || '-';
      profileName.textContent = nomClub;
      infoNom.textContent = nomClub;

      // Email
      profileEmail.textContent = user.email;
      infoEmail.textContent = user.email;

      // Date d'inscription
      const dateInscription = new Date(user.created_at);
      const options = { year: 'numeric', month: 'long', day: 'numeric' };
      infoDate.textContent = dateInscription.toLocaleDateString('fr-FR', options);

      // Statut
      if (user.email_confirmed_at) {
        infoStatut.textContent = 'Vérifié';
        infoStatut.classList.add('verified');
      } else {
        infoStatut.textContent = 'Non vérifié';
        infoStatut.classList.add('unverified');
      }

      // Avatar avec initiale du club
      const initiale = nomClub.charAt(0).toUpperCase();
      avatar.innerHTML = `<span class="avatar-initial">${initiale}</span>`;

      // Charger les infos du club depuis Supabase
      const club = await getClubFavoriSupabase();
      if (club) {
        infoNom.textContent = club.nom;
        profileName.textContent = club.nom;
        infoAbbr.textContent = club.abbr || '-';

        if (club.logo) {
          infoLogo.innerHTML = `<img src="${club.logo}" alt="Logo du club" style="max-width: 60px; max-height: 60px; border-radius: 8px;">`;
        }

        // Mettre à jour l'avatar avec le logo du club
        if (club.logo) {
          avatar.innerHTML = `<img src="${club.logo}" alt="Logo" style="width: 100%; height: 100%; object-fit: contain; border-radius: 50%;">`;
        }
      }
    })();

    // Déconnexion
    btnLogout.addEventListener('click', async () => {
      btnLogout.disabled = true;
      btnLogout.textContent = 'Déconnexion...';
      await deconnexion();
    });
  </script>

  <style>
    .club-logo-preview {
      width: 60px;
      height: 60px;
      background: rgba(255,255,255,0.1);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      color: rgba(255,255,255,0.5);
    }
    .club-logo-preview img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }
  </style>

</body>
</html>
